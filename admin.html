fetch("/api/list")
    .then(response => response.json())
    .then(data => {
        let categoryHtml = "";
        let selectHtml = "";

        Object.keys(data).forEach(category => {
            categoryHtml += `<h3>${category}</h3><ul>`;
            data[category].forEach(api => {
                categoryHtml += `<li><strong>${api.name}</strong> - <code>${api.url}</code></li>`;
                selectHtml += `<option value="${api.url}">${api.name}</option>`;
            });
            categoryHtml += `</ul>`;
        });

        document.getElementById("apiCategories").innerHTML = categoryHtml;
        document.getElementById("apiTest").innerHTML = selectHtml;
    });

function testApi() {
    let apiUrl = document.getElementById("apiTest").value;
    let input = document.getElementById("apiUrl").value;
    let fullUrl = apiUrl.replace("=apikey", "=user123") + input;

    fetch(fullUrl)
        .then(response => response.json())
        .then(data => {
            document.getElementById("apiResult").textContent = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            document.getElementById("apiResult").textContent = "Error: " + error;
        });
}
